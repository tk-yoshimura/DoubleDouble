using DoubleDouble;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using PrecisionTestTools;
using System;

namespace DoubleDoubleTest.DDouble {
    [TestClass]
    public class TiFunctionTests {
        [TestMethod]
        public void TiTest() {
            ddouble[] expecteds = {
                "0",
                "0.01562457618199652727962822123346827068789",
                "0.03124661034948540155139375569876031147457",
                "0.04686356495052372929081397290353502362274",
                "0.06247291133501439732135043970618182636256",
                "0.07807213414766608511473458567301938423291",
                "0.09365873565208353543988409335144794321162",
                "0.1092302399641612731743980801514244662738",
                "0.1247841971738965403944829201346014844376",
                "0.1403181873358840090859935758564781089537",
                "0.1558298243100861221944253349198437875235",
                "0.1713167594359662107153456612097886852011",
                "0.1867766850247021480605086482346783567075",
                "0.2022073376559399455296884252104937884996",
                "0.2176065012673721048735737532967245969999",
                "0.2329720100273071166332067791057788587346",
                "0.2483017509823068690800325599579354492848",
                "0.2635936664738813700128237589936645115451",
                "0.2788457563201198650451885110945938729527",
                "0.2940560797599807134611083678937270606056",
                "0.3092227571597379485570854154081724451833",
                "0.3243439714827714274826158464906468046530",
                "0.3394179695254736309206013614249597617184",
                "0.3544430629235160402629333737750488812200",
                "0.3694176289340609548243383434953267783131",
                "0.3843401110007127697709003682694708523512",
                "0.3992090191090709874878156884694370084947",
                "0.4140229299416730261885757769493536118610",
                "0.4287804868418980528970304990744691548376",
                "0.4434803995970456027760537986951699785723",
                "0.4581214440513085706392598960210964593218",
                "0.4727024615597348451942502380783860069729",
                "0.4872223582945223571102344976933379706091",
                "0.5016801044151266960681209047498525900354",
                "0.5160747331136876370832499316472563962870",
                "0.5304053395472104204626627200258801893738",
                "0.5446710796677793392836161600407135144907",
                "0.5588711689618451479312731187726893634011",
                "0.5730048811093240308304944249356917862127",
                "0.5870715465728841867277355028391523780434",
                "0.6010705511273859870766483676870143572868",
                "0.6150013343389922128227761723411609759416",
                "0.6288633880029845882254296472826317637766",
                "0.6426562545488196433754504551556564479155",
                "0.6563795254204381368216128858568720210417",
                "0.6700328394393144745566226892172249589325",
                "0.6836158811572017086537730629491824983792",
                "0.6971283792049990463496812939385588630388",
                "0.7105701046436469418061795775271651237120",
                "0.7239408693224437304425913331072759921651",
                "0.7372405242496807418711984662184754167796",
                "0.7504689579800126611953062963632010540483",
                "0.7636260950225188365930017300044583822137",
                "0.7767118942729710018110540136000026361111",
                "0.7897263474734047996005338752414977778670",
                "0.8026694777016974615420706736671025920232",
                "0.8155413378934825720018718866441530762621",
                "0.8283420093983852586357036772919812743617",
                "0.8410716005722373782221750656389881805340",
                "0.8537302454066320425929024509588811859459",
                "0.8663181021968996978027437974123871052068",
                "0.8788353522493333114411030405273948952983",
                "0.8912821986282572878274480080954772663227",
                "0.9036588649433226647264168331202542975279",
                "0.9159655941772190150546035149323841107741",
                "0.9282026475538202925195589286379002586714",
                "0.9403703034466265929006680405635088181461",
                "0.9524688563272254030679345595616292659913",
                "0.9644986157533733211163488538674393665966",
                "0.9764599053961914015537783623190795584855",
                "0.9883530621058731729690594664337683818357",
                "1.000178435015222979306805120376474366853",
                "1.011936384680272627457298959871223819285",
                "1.023627282257165436715600443586001309348",
                "1.035251508714447772925368333368571918205",
                "1.046809454079868147675633150890750145554",
                "1.058301516720752151359604064460036711577",
                "1.069728102656997094727514203737213378789",
                "1.081089624905712529640620539681510365404",
                "1.092386502856521125201327954439074395750",
                "1.103619161676528055115979532974840757550",
                "1.114788031743965515558929300010977674414",
                "1.125893548109521692861538217450122599232",
                "1.136936149984369931809525076749499604483",
                "1.147916280253923553075709151999744000424",
                "1.158834385016354305472952824067077973411",
                "1.169690913144927424710497513803794565715",
                "1.180486315873223348891668400524369821498",
                "1.191221046402334988080554561403850212469",
                "1.201895559529149767110540124666384222664",
                "1.212510311294847191879064896313722573678",
                "1.223065758652765190443687515539044031137",
                "1.233562359154811736491002361844643150066",
                "1.244000570655622081972918498881907321326",
                "1.254380851033686136526479977947496116969",
                "1.264703657928694981537430410409813744102",
                "1.274969448494380061814943180491890080529",
                "1.285178679166143139387009689613689505348",
                "1.295331805442799518207317862604600867197",
                "1.305429281681781265311922514133348166045",
                "1.315471560907171085102857154823368631490",
                "1.325459094629961081949707708522801561786",
                "1.335392332679953815172425204978186970713",
                "1.345271723048745761701856137871628926383",
                "1.355097711743255515424543238885514354740",
                "1.364870742649280735799792838904319518561",
                "1.374591257404588985695331131396085375409",
                "1.384259695281068149235464657222637039570",
                "1.393876493075482079667200339266775040020",
                "1.403442085008396484273449246095146074569",
                "1.412956902630858801683196659926524014539",
                "1.422421374738433963579857359719619181434",
                "1.431835927292215457929716124442887377513",
                "1.441200983346448027284852933514146458284",
                "1.450516962982414648642388475274715865326",
                "1.459784283248256157960463365008207294626",
                "1.469003358104407011655482851871196099888",
                "1.478174598374345229602511158871637511789",
                "1.487298411700368550914861592794312171009",
                "1.496375202504122267677089771237043341809",
                "1.505405371951617096249252015039656386402",
                "1.514389317922487814796855969971429071206",
                "1.523327434983255253874405194604976720155",
                "1.532220114364365589109362887998057055064",
                "1.541067743940791766454453878132842439392",
                "1.549870708215992306402235693015541330687",
                "1.558629388309032699346247620504198069902",
                "1.567344161944684135266194610303809406111",
                "1.576015403446323422360578946812144944278",
                "1.584643483731466656252682592639041470947",
                "1.593228770309777518862702757366323198082",
                "1.601771627283399028640171961731791383275",
                "1.610272415349465145983438562170101181556",
                "1.618731491804655873431424699154325905146",
                "1.627149210551666393365255626567427930951",
                "1.635525922107467369926272073156180991056",
                "1.643861973613239819704466807448273880881",
                "1.652157708845873940167770591777768191609",
                "1.660413468230926988098229769472960547680",
                "1.668629588856940734401304888513329747381",
                "1.676806404491024198096892368286921932525",
                "1.684944245595612292234615057093206399653",
                "1.693043439346315708663971774440965970308",
                "1.701104309650781837410745373144678967023",
                "1.709127177168490769863821494469772760571",
                "1.717112359331414482686511142436136982862",
                "1.725060170365471150591455508316448759995",
                "1.732970921312710199756055906525615910101",
                "1.740844920054167198251973242931236030742",
                "1.748682471333330993620051991094716571893",
                "1.756483876780168658509150298566301207363",
                "1.764249434935656800656893306118237223225",
                "1.771979441276770640649979385301166713945",
                "1.779674188241884966783354031924373580455",
                "1.787333965256543647567489907302837800004",
                "1.794959058759556825351388968387441362653",
                "1.802549752229387235199876976752838438394",
                "1.810106326210789297385120604394721644134",
                "1.817629058341666725165294021973096270691",
                "1.825118223380116377222153463208014236147",
                "1.832574093231627971270515025202977804091",
                "1.839996936976411066764437891730200194239",
                "1.847387020896822424916073976877100600142",
                "1.854744608504868467811860129420362854702",
                "1.862069960569759089453205810596190032930",
                "1.869363335145490524067614719938439511683",
                "1.876624987598436354848259334139009922375",
                "1.883855170634927053024676387941196036277",
                "1.891054134328799676313627219600030169883",
                "1.898222126148900530653656933419844115214",
                "1.905359390986524712840198785237392058038",
                "1.912466171182777507252075099658116058487",
                "1.919542706555843610154567100068984151665",
                "1.926589234428151102802587068173063680934",
                "1.933605989653417992343815888844032332690",
                "1.940593204643569989805968498461230029681",
                "1.947551109395518999596328615245750282651",
                "1.954479931517792557184179617200716955295",
                "1.961379896257005173108884063366528551433",
                "1.968251226524163224186543959447346178222",
                "1.975094142920795678706867267900159874415",
                "1.981908863764903553356142849702818900235",
                "1.988695605116721577320133338052289812853",
                "1.995454580804286085175437706310939198076",
                "2.002186002448803676351810426321478070571",
                "2.008890079489815666646384195261044141609",
                "2.015567019210153817925685373904700594279",
                "2.022217026760683267124825301967182566238",
                "2.028840305184828986240809444830665802540",
                "2.035437055442882492450665432426141559266",
                "2.042007476436085892936843186971972338818",
                "2.048551765030490693586430734040494939444",
                "2.055070116080589125506817603437129678155",
                "2.061562722452716049276131999487996681127",
                "2.068029775048219784980146020837186610954",
                "2.074471462826400487289306910167612682436",
                "2.080887972827214939966169085503748884201",
                "2.087279490193746884088139091657359332781",
                "2.093646198194442219705852896876460604870",
                "2.099988278245108632377786666504192806460",
                "2.106305909930679394734197734602343240274",
                "2.112599271026741279600566493452086999332",
                "2.118868537520826695891456515506971081284",
                "2.125113883633470322077576212212614168248",
                "2.131335481839030665109155186704451776028",
                "2.137533502886277115796255028838683441967",
                "2.143708115818743205322798781320215656538",
                "2.149859487994846892301507385158985582706",
                "2.155987785107778826032525226011285884430",
                "2.162093171205159639856825473219305389878",
                "2.168175808708467429121757097412564893997",
                "2.174235858432236661704392193384761316210",
                "2.180273479603029855652571614805165888237",
                "2.186288829878183438668488747644918342818",
                "2.192282065364329278221838401146864616001",
                "2.198253340635693439368210784653050437990",
                "2.204202808752173790176278355815799646746",
                "2.210130621277198132331492758252826391916",
                "2.216036928295364587266674458931219183615",
                "2.221921878429866016339073064221681421547",
                "2.227785618859700297383771620818375409975",
                "2.233628295336668319666471647766974375232",
                "2.239450052202161595064323299714362194914",
                "2.245251032403741415439579896704091100788",
                "2.251031377511511514844477472943293205581",
                "2.256791227734286220603425473707495725318",
                "2.262530721935556099646954905189285009449",
                "2.268249997649253125898058739274398911556",
                "2.273949191095317411203738594583662061094",
                "2.279628437195067556422355778471949684056",
                "2.285287869586376690972260735907935951722",
                "2.290927620638656278562903339854069568994",
                "2.296547821467649774102622169101771601393",
                "2.302148601950038222037005414721357658777",
                "2.307730090737859889740901791104448150526",
                "2.313292415272746031182317781497900660488",
                "2.318835701799974876008048684372047980261",
                "2.324360075382345937573732374063586195148",
                "2.329865659913876730354441392120228607759",
                "2.335352578133323982720141545226587009869",
                "2.340820951637531425332644560722853913130",
                "2.346270900894606228501712073627674697005",
                "2.351702545256926153807944734030260966122",
                "2.357116002973979476235021935574962507161",
                "2.362511391205039723025753252567663295603",
                "2.367888826031677264553469190996618461378",
                "2.373248422470109780747110140248330410196",
                "2.378590294483393614086128236987840400961",
                "2.383914554993458006947893341461358918874",
                "2.389221315892984207200485992398076425834",
                "2.394510688057131411439414071551750767472",
                "2.399782781355111500216952075639082836315",
                "2.405037704661614504053856944442207180250",
                "2.410275565868086722999017967872235951626",
                "2.415496471893863406054603176699318202506",
                "2.420700528697157879951640663640580252160",
                "2.425887841285908999580721458195549396623"
            };

            for ((int i, ddouble x) = (0, 0); i < expecteds.Length; i++, x += 1d / 64) {
                ddouble expected = expecteds[i];

                ddouble y = ddouble.Ti(x);
                ddouble y_neg = ddouble.Ti(-x);
                ddouble y_dec = ddouble.Ti(ddouble.BitDecrement(x));
                ddouble y_inc = ddouble.Ti(ddouble.BitIncrement(x));

                Console.WriteLine(x);
                Console.WriteLine(y);

                PrecisionAssert.AlmostEqual(expected, y, 1e-31d);
                PrecisionAssert.AlmostEqual(-expected, y_neg, 1e-31d);

                if (x > 0d) {
                    PrecisionAssert.AlmostEqual(expected, y_dec, 1e-31d);
                    PrecisionAssert.AlmostEqual(expected, y_inc, 1e-31d);
                }
            }

            PrecisionAssert.AreEqual(0, ddouble.Ti(0));

            PrecisionAssert.IsFinite(ddouble.Ti(ddouble.Epsilon));

            PrecisionAssert.IsNaN(ddouble.Ti(ddouble.NaN));
            PrecisionAssert.IsPositiveInfinity(ddouble.Ti(ddouble.PositiveInfinity));
            PrecisionAssert.IsNegativeInfinity(ddouble.Ti(ddouble.NegativeInfinity));
        }
    }
}
