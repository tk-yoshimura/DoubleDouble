using DoubleDouble;
using System;
using System.IO;

namespace DoubleDoubleSandbox {
    public static class Program {
        static void Main() {
            //for (ddouble v = 1d / 8192; v <= 1; v += 1d / 8192) {
            //    ddouble x = LogMk4(v);
            //    ddouble y = LogMk3(v);

            //    Console.WriteLine(y / x - 1);
            //}

            for (ddouble v = 1d / 8192; v <= 1; v += 1d / 8192) {
                ddouble x = ddouble.Log2(1 + v);
                ddouble y = ddouble.Pow2(x);

                Console.WriteLine(ddouble.Abs(y - v - 1));
            }

            Console.WriteLine("END");
            Console.Read();
        }

        public static ddouble LogMk2(ddouble x) {
            ddouble y =
                x * (23d * (2d + x)
                    * ("354941003085308640"
                + x * ("3549410030853086400"
                + x * ("16412582041890434400"
                + x * ("46555052497700947200"
                + x * ("90619246611214769448"
                + x * ("128289892261382115264"
                + x * ("136603235643434610336"
                + x * ("111598153149703252032"
                + x * ("70726232978806188784"
                + x * ("34933000561634535360"
                + x * ("13437846772554134112"
                + x * ("4003559017830759296"
                + x * ("914066313765961902"
                + x * ("157328255322849624"
                + x * ("19937281228280052"
                + x * ("1798817569254888"
                + x * ("110109050232090"
                + x * ("4254540825080"
                + x * ("92421446460"
                + x * ("913741080"
                + x * ("2490417"
                ))))))))))))))))))))))
            / (7759752d
                    * ("2104098963720"
                + x * ("23145088600920"
                + x * ("118685861314020"
                + x * ("376780512108000"
                + x * ("829376615067000"
                + x * ("1343590116408540"
                + x * ("1659391212145590"
                + x * ("1597008083869440"
                + x * ("1213941955644000"
                + x * ("734359948476000"
                + x * ("354590946549840"
                + x * ("136526995463040"
                + x * ("41716581947040"
                + x * ("10028024506500"
                + x * ("1871589827250"
                + x * ("266181664320"
                + x * ("28109701620"
                + x * ("2125943820"
                + x * ("109359250"
                + x * ("3542000"
                + x * ("63756"
                + x * ("506"
                + x
                )))))))))))))))))))))));

            y *= ddouble.LbE;

            return y;
        }

        private static ddouble LogMk3(ddouble x) {
#if DEBUG
            if (!(x >= 0d) || x > 1d) {
                throw new ArgumentOutOfRangeException(nameof(x));
            }
#endif

            if (x == 1d) {
                return 1d;
            }

            ddouble y =
                x * (5601466d * (2d + x)
                    * (1457411875920d
                + x * (14574118759200d
                + x * (67391177053200d
                + x * (191158208841600d
                + x * (372088783910844d
                + x * (526767014565792d
                + x * (560902167361008d
                + x * (458229599616096d
                + x * (290406718261352d
                + x * (143437273906080d
                + x * (55176711912336d
                + x * (16438885357888d
                + x * (3753218392581d
                + x * (646000506372d
                + x * (81863831406d
                + x * (7386067164d
                + x * (110109050232090d
                + x * (4254540825080d
                + x * (92421446460d
                + x * (913741080d
                + x * (2490417d
                ))))) / 243542d
                )))))))))))))))))
                / (7759752d
                    * (2104098963720d
                + x * (23145088600920d
                + x * (118685861314020d
                + x * (376780512108000d
                + x * (829376615067000d
                + x * (1343590116408540d
                + x * (1659391212145590d
                + x * (1597008083869440d
                + x * (1213941955644000d
                + x * (734359948476000d
                + x * (354590946549840d
                + x * (136526995463040d
                + x * (41716581947040d
                + x * (10028024506500d
                + x * (1871589827250d
                + x * (266181664320d
                + x * (28109701620d
                + x * (2125943820d
                + x * (109359250d
                + x * (3542000d
                + x * (63756d
                + x * (506d
                + x
                )))))))))))))))))))))));

            y *= ddouble.LbE;

            return y;
        }

        public static ddouble LogMk4(ddouble x) {
            ddouble y =
                  x * ("1469455752773177769600"
                + x * ("16164013280504955465600"
                + x * ("82918122671762036699040"
                + x * ("263440761899946925694400"
                + x * ("580633924129684551366240"
                + x * ("942364252479412195392960"
                + x * ("1166775346421285102773128"
                + x * ("1126587660897678064772544"
                + x * ("859936464977052190384800"
                + x * ("522938446796098958264640"
                + x * ("254152078260633128408560"
                + x * ("98644286231546793646272"
                + x * ("30440740957692565115616"
                + x * ("7407073935628763739200"
                + x * ("1403350407843211160190"
                + x * ("203346183767716206360"
                + x * ("21982374244594367604"
                + x * ("1712765386732792392"
                + x * ("91581432276584250"
                + x * ("3124425290987000"
                + x * ("60532315163100"
                + x * ("538752830760"
                + x * ("1332950097"
                )))))))))))))))))))))))
                 /
                   ("1469455752773177769600"
             + x * ("16898741156891544350400"
             + x * ("90877674665950082951040"
             + x * ("303614049452151413495520"
             + x * ("706079184772445147664000"
             + x * ("1213783741442155706222400"
             + x * ("1598642000923814832585600"
             + x * ("1650026922382080309347280"
             + x * ("1353868244005809484592640"
             + x * ("890702792109085187232000"
             + x * ("471831749333461342425600"
             + x * ("201362539488270118358400"
             + x * ("69038584967406897722880"
             + x * ("18899703124561616797440"
             + x * ("4090844832156194112000"
             + x * ("690330065426357756400"
             + x * ("89074847151788097600"
             + x * ("8558171589093366240"
             + x * ("590218730282301120"
             + x * ("27735842588454000"
             + x * ("821802743361600"
             + x * ("13546199066400"
             + x * ("98517811392"
             + x * ("178474296"       ))))))))))))))))))))))));          

            y *= ddouble.LbE;

            return y;
        }
    }
}
